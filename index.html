<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sharma Interiors ‚Äì Invoice & Quotation</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#6f42c1" />
  <link rel="icon" href="https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=328,fit=crop,q=95/Aq2vz9xo5lcWbKB3/si-logo-dWxyGXReKrCp8b7y.png" type="image/png" />
  <style>
    *{box-sizing:border-box;}
    body {
      margin:0;padding:0;
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:#f8f9fc;color:#222;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark {
      background:#23223a;color:#f5f5f5;
    }
    .wrapper {
      max-width:960px;margin:1rem auto;padding:1rem;
    }
    .card {
      background:#fff;
      border-radius:8px;
      padding:1rem;
      margin-bottom:1rem;
      box-shadow:0 2px 5px rgba(0,0,0,.07);
      transition: background-color 0.3s, color 0.3s;
    }
    .dark .card {
      background:#2a2a3d;color:#f5f5f5;
    }
    .card h2 {
      margin-top:0;color:#6f42c1;
    }
    input,select,textarea,button {
      font-size:1rem;
      border-radius:6px;
      border:1px solid #ccc;
      padding:0.7rem;
      margin:5px 0;
      font-family:inherit;
      transition: background-color 0.3s, color 0.3s, border-color 0.3s;
    }
    input:focus,select:focus,textarea:focus {
      outline:none;
      border-color:#6f42c1;
      box-shadow:0 0 5px #6f42c1aa;
      background-color:#fff;
      color:#222;
    }
    .dark input,.dark select,.dark textarea {
      background:#333347;
      color:#fff;
      border:1px solid #555;
    }
    .dark input:focus,.dark select:focus,.dark textarea:focus {
      background:#444458;
      border-color:#6f42c1;
      box-shadow:0 0 5px #6f42c1aa;
    }
    button {
      background:#6f42c1;
      color:#fff;
      border:none;
      cursor:pointer;
      transition: background-color 0.3s;
      min-width: 120px;
    }
    button:hover {
      background:#5533a0;
    }
    .row {
      display:flex;
      flex-wrap:wrap;
      gap:1rem;
    }
    .row > * {
      flex:1;
      min-width:120px;
    }
    @media(max-width:640px){
      .row {
        flex-direction:column;
      }
    }
    .item-table {
      width:100%;
      border-collapse:collapse;
      margin-top:0.5rem;
    }
    .item-table th,.item-table td {
      border:1px solid #ccc;
      padding:0.5rem;
      text-align:left;
      vertical-align: middle;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark .item-table th {
      background:#3d3d5a;
    }
    .dark .item-table td {
      background:#2d2d45;
    }
    .item-table th {
      background:#f4f0fb;
    }
    .item-table td button {
      background:#e74c3c;
      padding:3px 10px;
      font-size:0.9em;
      border-radius: 4px;
      border:none;
      cursor:pointer;
      color:#fff;
      transition: background-color 0.3s;
    }
    .item-table td button:hover {
      background:#c0392b;
    }
    .total-display {
      font-size:1.3rem;
      font-weight:bold;
      margin: 0.5rem 0;
    }
    textarea#terms {
      min-height:80px;
      width: 100%;
      resize: vertical;
    }
    .hidden {
      display:none !important;
    }
    #loginMsg,#passMsg {
      color:#e74c3c;
      min-height:1.2em;
    }
    #companyLogo {
      max-width:130px;
      border-radius:6px;
      cursor:pointer;
      transition:opacity 0.3s;
    }
    #companyLogo:hover {
      opacity:0.8;
    }
    .action-buttons {
      text-align:center;
      margin: 2rem 0 1rem;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .action-buttons button {
      min-width: 140px;
    }
    #changePassForm {
      max-width: 360px;
      margin: 2rem auto;
    }

    /* Hide these controls when printing */
    @media print {
      #darkModeToggle,
      label[for="darkModeToggle"],
      .action-buttons,
      #changePassForm {
        display: none !important;
      }
      #companyLogo {
        display: block !important;
        max-width: 200px;
        margin: 0 auto 1rem auto;
      }
      body {
        background: #fff !important;
        color: #000 !important;
      }
      .card {
        box-shadow: none !important;
        border: none !important;
      }
    }

    /* Utility class to hide controls in UI */
    .hidden-controls {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="wrapper" role="main">

    <!-- LOGIN MODULE -->
    <div id="loginDiv" class="card" role="region" aria-label="Login module">
      <h2>üîê Secure Login</h2>
      <div>
        <button onclick="showLogin()" aria-label="Switch to Login tab">Login</button>
        <button onclick="showRegister()" aria-label="Switch to Sign Up tab">Sign Up</button>
        <button onclick="showForgot()" aria-label="Switch to Forgot Password tab">Forgot Password?</button>
      </div>

      <div id="loginForm">
        <input type="text" id="loginUser" placeholder="Username" autocomplete="username" aria-label="Username" />
        <input type="password" id="loginPass" placeholder="Password" autocomplete="current-password" aria-label="Password" />
        <button onclick="handleLogin()">Login</button>
      </div>

      <div id="registerForm" class="hidden">
        <input type="text" id="registerUser" placeholder="Choose username" autocomplete="username" aria-label="Choose username" />
        <input type="password" id="registerPass" placeholder="Password" autocomplete="new-password" aria-label="Password" />
        <input type="password" id="registerPass2" placeholder="Confirm password" autocomplete="new-password" aria-label="Confirm password" />
        <button onclick="handleRegister()">Create Account</button>
      </div>

      <div id="forgotForm" class="hidden">
        <input type="text" id="forgotUser" placeholder="Enter your username" autocomplete="username" aria-label="Enter username" />
        <button onclick="handleForgot()">Continue</button>

        <input type="password" id="newPass" class="hidden" placeholder="New password" autocomplete="new-password" aria-label="New password" />
        <input type="password" id="newPass2" class="hidden" placeholder="Confirm new password" autocomplete="new-password" aria-label="Confirm new password" />
        <button id="setPassBtn" class="hidden" onclick="handleReset()">Set New Password</button>
      </div>

      <p id="loginMsg" role="alert" aria-live="assertive"></p>
    </div>

    <!-- APP INTERFACE (hidden until login) -->
    <div id="mainApp" class="hidden" role="region" aria-label="Invoice app interface" aria-live="polite">

      <header class="card" style="text-align:center;">
        <img src="https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=328,fit=crop,q=95/Aq2vz9xo5lcWbKB3/si-logo-dWxyGXReKrCp8b7y.png"
            id="companyLogo"
            alt="Sharma Interiors Logo"
            title="Click to upload a new logo"
            role="img"
            tabindex="0"
            onclick="document.getElementById('uploadLogo').click()" />
        <input type="file" id="uploadLogo" hidden accept="image/*" />
        <h1>Sharma Interiors</h1>
        <p>S No. 27, Bhosale Khedekar Industries, Narhe, Pune - 411041</p>
        <p>Email: ashoksharma83.pune@gmail.com | Phone: +91-98500-19125</p>
      </header>

      <section class="card row">
        <div><label for="docType">Type:</label>
          <select id="docType" aria-label="Document type"><option>Quotation</option><option>Invoice</option></select>
        </div>
        <div><label for="docNumber">Doc #:</label>
          <input id="docNumber" readonly aria-readonly="true" />
        </div>
        <div><label for="invoiceDate">Date:</label>
          <input type="date" id="invoiceDate" />
        </div>
        <div><label for="dueDate">Due Date:</label>
          <input type="date" id="dueDate" readonly aria-readonly="true" />
        </div>
        <div style="align-self:center;">
          <label for="darkModeToggle"><input type="checkbox" id="darkModeToggle" />&nbsp;Dark Mode</label>
        </div>
      </section>

      <section class="card" aria-label="Client Information">
        <h2>üë§ Client Information</h2>
        <div class="row">
          <input id="clientName" placeholder="Name *" />
          <input id="clientCompany" placeholder="Company" />
        </div>
        <div class="row">
          <input id="clientEmail" placeholder="Email *" />
          <input id="clientPhone" placeholder="Phone *" />
        </div>
        <input id="clientAddress" placeholder="Billing Address *" />
        <div class="row">
          <input id="clientGST" placeholder="GST No." />
          <select id="paymentTerms" aria-label="Payment Terms">
            <option value="">Payment Terms</option>
            <option value="0">Advance</option>
            <option value="7">7 Days</option>
            <option value="15">15 Days</option>
            <option value="30">30 Days</option>
          </select>
          <select id="paymentStatus" aria-label="Payment Status">
            <option>Unpaid</option>
            <option>Paid</option>
            <option>Partial</option>
            <option>Overdue</option>
          </select>
        </div>
        <div class="row">
          <button onclick="saveClient()">üíæ Save Client</button>
          <select id="clientList" onchange="loadClient(this.value)" aria-label="Load client">
            <option value="">Load Client</option>
          </select>
        </div>
      </section>

      <section class="card" aria-label="Item Details">
        <h2>üßæ Item Details</h2>
        <div class="row">
          <input id="itemDesc" list="itemLib" placeholder="Description" />
          <input id="itemQty" type="number" placeholder="Qty" min="0" />
          <input id="itemRate" type="number" placeholder="Rate ‚Çπ" min="0" step="0.01" />
          <button onclick="addItem()">‚ûï Add Item</button>
        </div>
        <datalist id="itemLib">
          <option value="False Ceiling POP" />
          <option value="Kitchen Modular Setup" />
          <option value="Wooden Wardrobe" />
          <option value="Interior Painting - Bedroom" />
          <option value="Electrical Setup" />
        </datalist>
        <table class="item-table" aria-label="Invoice items table">
          <thead>
            <tr>
              <th>Description</th>
              <th>Qty</th>
              <th>Rate</th>
              <th>Amount</th>
              <th>Remove</th>
            </tr>
          </thead>
          <tbody id="itemTableBody"></tbody>
        </table>
        <div class="row">
          <input type="number" id="gstInput" placeholder="GST %" min="0" max="100" step="0.01" />
          <input type="number" id="discountInput" placeholder="Discount" min="0" step="0.01" />
          <select id="discountType" aria-label="Discount type">
            <option value="flat">Flat ‚Çπ</option>
            <option value="percent">%</option>
          </select>
        </div>
      </section>

      <section class="card" aria-label="Summary">
        <h2>üìä Summary</h2>
        <p class="total-display">Grand Total: ‚Çπ <span id="grandTotal">0.00</span></p>
      </section>

      <section class="card">
        <h2>üìú Terms & Conditions</h2>
        <textarea id="terms">Payment is due as per agreed terms. Late payments may incur penalties.</textarea>
      </section>

      <div class="action-buttons">
        <button onclick="window.print()">üñ® Print</button>
        <button onclick="savePDF()">‚¨á Download PDF</button>
        <button onclick="saveQuote()">üíæ Save Quote</button>
        <button onclick="saveExcel()">üìä Export Excel</button>
        <button onclick="shareEmail()">‚úâÔ∏è Share Email</button>
        <button onclick="shareWhatsApp()">üí¨ Share WhatsApp</button>
        <button onclick="logout()">üö™ Logout</button>
        <button onclick="showChangePassword()">üîë Change Password</button>
      </div>

      <div id="changePassForm" class="card hidden" role="dialog" aria-modal="true" aria-labelledby="changePassTitle">
        <h3 id="changePassTitle">Change Password</h3>
        <input type="password" id="oldPass" placeholder="Old password" autocomplete="current-password" />
        <input type="password" id="newPass1" placeholder="New password" autocomplete="new-password" />
        <input type="password" id="newPass1b" placeholder="Confirm new password" autocomplete="new-password" />
        <button onclick="handleChangePass()">Update Password</button>
        <button onclick="hideChangePassword()">Cancel</button>
        <p id="passMsg"></p>
      </div>
    </div>
  </div>

  <!-- PDF export lib -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <script>
    // -- Full JavaScript as previously outlined ---
    // Authentication helpers, UI show/hide, login/register/reset/change pass functions
    
    // Your full integrated JavaScript code here (same as section "Step 2" code in previous message)
    // For brevity not restating to avoid length repetition, please copy the full script block from the previous step.

    // If you want I can re-send the full JS block here again verbatim.
  </script>
</body>
</html>
